name: CI

on:
  push:
    # tags-ignore:
    # - 'v*'
    # branches:
    # - "master"
  pull_request:
  workflow_call:
    secrets:
      CODECOV_TOKEN:
        required: true

concurrency:
  group: ${{ github.workflow }}-${{ github.event.pull_request.number || github.ref }}
  cancel-in-progress: true

jobs:
  ci:
    uses: .github/workflows/docker-buildx-push.yml
    permissions:
      id-token: write
      contents: write
    with:
      platforms: linux/amd64,linux/386,linux/arm,linux/arm64
      tags: ${{ needs.create_release.outputs.docker_tags }}
      docker_image: maxwelldps/step-ca
      docker_file: docker/Dockerfile
    secrets: inherit